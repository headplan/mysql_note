# 基础应用

#### MySQL体系结构

**什么是体系结构?**

体系结构包括一组部件以及部件之间的联系 .

**Mysql的部件有那些?**

![](/assets/mysqbujian.png)

**1.Connectors指的是不同语言中与SQL的交互,就是连接器**

简单说就是接口的客户端 .

比如上图中的Native C API, php,python等.

**2.Management Serveices & Utilities , 系统管理和控制工具**

mysql , mysqldump等 , 用来管理数据库,备份,恢复,安全控制等等 .

**3.Connection Pool : 连接池 . **

管理缓冲用户连接 , 线程处理,验证,安全,检查等需要缓存的需求 .

**4.SQL Interface : SQL接口**

接受用户的SQL命令 , 并且返回用户需要查询的结果 . 比如select from就是调用SQL Interface

**5.Parser : 解析器**

SQL命令传递到解析器的时候会被解析器验证和解析 . 主要功能 :

a . 将SQL语句分解成数据结构 , 并将这个结构传递到后续步骤 , 以后SQL语句的传递和处理就是基于这个结构的

b . 如果在分解构成中遇到错误 , 那么就说明这个sql语句是不合理的 . 比如经常遇到的1064的错误 , 也就是语法错误 .

**6.Optimizer : 查询优化器**

SQL语句在查询之前会使用查询优化器对查询进行优化 . 他使用的是“选取-投影-联接”策略进行查询 .

优化器会根据实际情况做一个预估和判断 , 解析SQL语句后 , 传给查询优化器 , 同样的SQL语句在数据量不一样的情况时 , 给出的查询优化方式也是不一样的 , 它会自动根据数据量去优化 . 比如联查时候 , 有两种索引都可以用 , 在数据量少的时候 , 优化器可能认为全表扫描比用索引更快 , 就会全表扫\(当然实际中一般不会这样\) , 当第一种索引比第二种索引好的时候 , 就优化为用索引一 . 或者左连和右连查的时候 , 也可能会转成内联的方式去查 . 这就是优化器的功能 .

用一个例子就可以理解： select uid,name from user where gender = 1;

这个select查询先根据where语句进行选取 , 而不是先将表全部查询出来以后再进行gender过滤

这个select查询先根据uid和name进行属性投影 , 而不是将属性全部取出以后再进行过滤

将这两个查询条件联接起来生成最终查询结果

**7.Cache和Buffer : 查询缓存**

如果查询缓存有命中的查询结果 , 查询语句就可以直接去查询缓存中取数据 .

这个缓存机制是由一系列小缓存组成的 . 比如表缓存 , 记录缓存 , key缓存 , 权限缓存等 .

**8.Engine : 存储引擎**

存储引擎是MySql中具体的与文件打交道的子系统 . 也是Mysql最具有特色的一个地方 .

Mysql的存储引擎是插件式的 . 它根据MySql AB公司提供的文件访问层的一个抽象接口来定制一种文件访问机制\(这种访问机制就叫存储引擎\)现在有很多种存储引擎 , 各个存储引擎的优势各不一样 , 最常用的MyISAM,InnoDB .

---

#### MySQL的各个功能模块中的执行过程

![](/assets/mysqljiagoutu.png)**MySQL可以分为Server层和存储引擎层两部分**

**Server层包括**

* 连接器\(Connectors\)
* 查询缓存\(Cache , Buffer\)
* 分析器\(也叫解释器 , Parser\)
* 查询优化器\(Optimizer\)
* 执行器\(SQL接口 , SQL Interface\)

以及所有的内置函数\(如日期 , 时间 , 数学和加密函数等\) , 所有跨存储引擎的功能也都在这一层实现 , 比如存储过程 , 触发器 , 视图等 .

**存储引擎**

负责数据的存储和提取 . 架构模式是插件式的 , 支持InnoDB , MyISAM , Memory等 . MySQL5.5.5版本开始使用InnoDB作为默认的存储引擎 .

> 在create table语句中使用engine=memory来指定存储引擎 .

#### SQL执行流程



